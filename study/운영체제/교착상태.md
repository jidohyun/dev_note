
### 정의

둘 이상의 프로세스들이 서로 다른 프로세스가 점유하고 있는 자원을 기다리느라 무한히 대기하는 상태.

### 교착상태 발생 조건

1. 상호 배제(Mutual Exclusion)
	- 하나의 자원에는 한 번에 하나의 프로세스만 접근하여 사용할 수 있어야 한다. 만약 여러 프로세스가 동시에 자원을 공유할 수 있다면 교착상태는 발생하지 않는다. (ex: 프린터는 한 번에 하나의 작업만 인쇄할 수 있다.)
2. 점유와 대기(Hold and Wait)
	- 최소한 하나의 자원을 점유하고 있는 프로세스가 다른 프로세스에 할당된 자원을 추가로 얻기 위해 대기하는 상태여야 한다. 즉, 자원을 들고 있으면서 다른 자원을 기다리는 상황이다.
3. 비선점(No Preemption)
	- 어떤 프로세스에 할당된 자원은 해당 프로세스가 작업을 끝내고 자발적으로 자원을 반납하기 전에는 강제로 빼앗을 수 없어야 한다. 운영체제나 다른 프로세스가 강제로 자원을 회수할 수 있다면 교착상태는 발생하기 어렵다.
4. 순환 대기(Circular Wait)
	- 두 개 이상의 프로세스들이 자원 할당 그래프에서 원형을 이루며 서로를 기다리는 상태여야 한다. (ex: 프로세스 A는 프로세스 B가 가진 자원을 기다리고, 프로세스 B는 프로세스 C가 가진 자원을 기다리며, 프로세스 C는 다시 프로세스 A가 가진 자원을 기다리는 식이다.)

### 교착상태 해결

1. 교착상태 예방(Deadlock Prevention)
	- 교착상태 발생 조건 중 하나 이상을 아예 충족시키지 않도록 시스템을 설계하는 방법
		- 상호 배제 부정: 자원을 공유 가능하게 만들지만, 현실적으로 불가능함.
		- 점유와 대기 부정: 프로세스가 필요한 모든 자원을 한 번에 할당받거나, 아무 자원도 할당받지 않도록 한다. -> 자원 낭비 발생, 무한 대기 현상 발생 가능
		- 비선점 부정: 모든 자원에 대해 선점 허용 -> 현실적으로 불가능
		- 순환 대기 부정: 자원에 순서를 부여하여 오름차순으로만 자원을 요청하도록 한다. 자원 활용이 비효율적일 수 있다.
	- **교착상태 예방을 교착상태가 정대 발생하지 않지만 심각한 자원 낭비가 발생하며, 비현실적임. -> 회피, 발견, 회복을 이용**
2. 교착상태의 회피(Avoidance)
	- 시스템의 상태를 계속 감시
	- 시스템이 교착상태가 될 가능성이 있는 자원 할당은 요청 보류
	- 시스템을 항상 안전 상태(safe state: 교착상태를 일으키지 않으면서 각 프로세스에게 필요한 자원을 할당해 줄 수 있는 상태)로 유지
		- 안전상태(safe state): 모든 프로세스가 정상적 종료 가능한 상태, 안전순서열(safe sequence)이 존재 -> 교착상태가 되지 않을 수 있음을 보장
		- 불완전 상태(unsafe state): 교착상태가 될 가능성이 있음. but 반드시 발생한다는 의미는 아님.
	- [[Dijkstra's 은행원 알고리즘]]
		- 교착상태 회피를 위한 간단한 이론적 기법
		- 한 종류의 자원이 여러 개라는 가정하에 시스템을 항상 안전 상태로 유지
		- Habermann's Algorithm: 여러 종류의 자원을 고려한 Dijkstra's 은행원 알고리즘의 확장판
		- 자료구조: 가용자원(Available), 최대요구(Max), 할당자원(Allocation), 추가요구(Need)
3. 교착상태의 탐지 및 회복(Detection)
	1. 탐지
		- 교착상태 방지를 위한 사전 작업을 하지 않음 -> 교착상태 발생 가능
		- 주기적으로 교착상태 발생 확인
			- 시스템이 교착상태인가?
			- 어떤 프로세스가 교착상태인가?
		- 반드시 회복 과정이 필요
		- 탐지 알고리즘
			- 자료 구조: 가용자원(Available), 할당자원(Allocation), 요청자원(Request) -> Max 필요없음
		- **교착상태 회피 vs 탐지**
			- 회피
				- 최악의 경우를 생각(앞으로 일어날 일을 고려)
				- 교착상태가 발생하지 않음
			- 탐지
				- 최선의 경우를 생각(현재 상태만 고려)
				- 교착상태 발생 시 **회복 과정이 필요**
	2. 회복
		- 교착상태를 검출한 후 해결하는 과정
		- 프로세스 종료
			- 교착상태에 있는 프로세스를 종료시킴
			- 강제 종료된 프로세스는 이후 재시작 됨.
		- 자원 선점
			- 교착상태 해결 위해 선점할 자원 선택
			- 선정된 자원을 가지고 있는 프로세스에서 자원을 빼앗음 -> 자원을 빼앗긴 프로세스는 강제 종료됨
		- 복귀(Rollback)
			- 프로세스 강제 종료 후, 가장 최근의 checkpoint에서 재시작